# PromptGrade

軽量なプロンプト評価アプリ（MVP）。

このリポジトリはローカルで短時間で試せることを目標にしています。主な機能は以下です:

- ユーザーが入力したプロンプトを OpenAI（またはローカルモック）で評価
- Streamlit によるシンプルな UI

---

## 目次

- 環境構築
- 実行方法
- 環境変数（API キー）
- テスト
- データ保存 / マイグレーション
- 補足

---

## 環境構築

### 1. Python 仮想環境を作成して有効化

```bash
python -m venv .venv
source .venv/bin/activate
```

### 2. 依存関係をインストール

```bash
pip install -r requirements.txt
```

※ 現在の `requirements.txt` はアプリとテストに必要な最小セットに絞っています（`streamlit`, `openai`, `pytest`）。機能拡張で追加パッケージが必要になった場合は適宜追加してください。

---

## 実行方法

ローカルで Streamlit アプリを起動します:

```bash
streamlit run app.py
```

ブラウザが自動で開かない場合は表示されたローカル URL にアクセスしてください（既定: <http://localhost:8501）。>

---

## 環境変数（API キー）の扱い

- アプリは環境変数 `OPENAI_API_KEY` を優先して使用します。
- UI から一時的に API キーを入力することも可能です（ブラウザ上の入力はセッション限定で保存されません）。
- セキュリティ上、公開リポジトリに API キーをコミットしないでください。

注: `app.api.grade_prompt()` には `use_mock` 引数があります。UI 上の明示的な「モックを選択する」オプションは現在削除されていますが、開発やテスト時に関数呼び出し側から `use_mock=True` を渡せばモック動作できます。

---

## テスト

簡易テストランナーと個別テストが用意されています。仮想環境を有効にした状態で実行してください。

プロジェクト付属の簡易ランナー:

```bash
python tests/run_tests.py
```

または pytest を直接使う:

```bash
pytest -q
```

テスト内容の概略:

- `app.api` の JSON 抽出やスコア検証
- `app.api` のモック／フォールバック挙動
- （注）`tests/test_storage.py` は `app.storage` を参照します。現在リポジトリに `app/storage.py` が存在しない場合、テストは失敗します。ストレージ機能を追加するかテストを調整してください。

---

## データ保存 / マイグレーション

プロジェクトでは将来的に JSON ベースの履歴を SQLite に移行するスクリプトを用意しています（スクリプトや `app/db.py` が存在する場合）。例:

```bash
python scripts/migrate_to_sqlite.py
```

このリポジトリの現状によってはスクリプトや `app/db.py` が未実装のことがあります。移行機能を使いたい場合は該当ファイルの有無を確認してください。

---

## 補足

- ライセンスや貢献ガイドラインを追加したい場合は `CONTRIBUTING.md`・`LICENSE` を追加してください。
- 追加機能（履歴保存、SQLite、UI の改善など）を実装する際は、`requirements.txt` を更新してから PR を作成してください。

---

最終更新: プロジェクトのコードベースに合わせて README を簡潔化しました。
